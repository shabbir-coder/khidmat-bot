"use strict";(self.webpackChunkcoreui_free_angular_admin_template=self.webpackChunkcoreui_free_angular_admin_template||[]).push([[635],{8635:(z,m,c)=>{c.r(m),c.d(m,{ChatModule:()=>J});var h=c(6814),C=c(2098),t=c(5678),_=c(1336),s=c(1806),f=c(5619),v=c(3620),M=c(4664),a=c(95),x=c(2791),O=["512 512","<rect width='32' height='176' x='240' y='176' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><rect width='32' height='32' x='240' y='384' fill='var(--ci-primary-color, currentColor)' class='ci-primary'/><path fill='var(--ci-primary-color, currentColor)' d='M274.014,16H237.986L16,445.174V496H496V445.174ZM464,464H48V452.959L256,50.826,464,452.959Z' class='ci-primary'/>"],P=c(3519),p=c.n(P),g=c(9862),T=c(9947),y=c(5887);let A=(()=>{class o{constructor(e){this.http=e,this.apiUrl=T.N.apiUrl,this.socket=(0,y.io)("http://5.189.156.200:82/nodejs"),this.message$=new f.X("")}getHeaders(){const e=localStorage.getItem("authToken");return new g.WM({"Content-Type":"application/json",Authorization:`${e}`})}addContact(e){return this.http.post(`${this.apiUrl}/chats/saveContact`,e,{headers:this.getHeaders()})}updateContact(e,n){return this.http.post(`${this.apiUrl}/chats/updateContact/${e}`,n,{headers:this.getHeaders()})}getContacts(e){return this.http.get(`${this.apiUrl}/chats/getContacts`,{headers:this.getHeaders(),params:e})}sendMessage(e){return this.http.post(`${this.apiUrl}/chats/sendMessage`,e,{headers:this.getHeaders()})}getAllMessage(e){return this.http.post(`${this.apiUrl}/chats/getMessages`,e,{headers:this.getHeaders()})}socketListen(e){return this.socket.on(e,n=>{this.message$.next(n)}),this.message$.asObservable()}static#t=this.\u0275fac=function(n){return new(n||o)(t.LFG(g.eN))};static#e=this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var b=c(1272),u=c(6472);function Z(o,d){if(1&o){const e=t.EpF();t.TgZ(0,"div",22),t.NdJ("click",function(){const r=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.selectContact(r))}),t.TgZ(1,"div",23)(2,"h6",24),t._uU(3),t.qZA()(),t.TgZ(4,"div",25)(5,"h5",26),t._uU(6),t.TgZ(7,"span",27),t._uU(8),t.qZA()(),t.TgZ(9,"p",28),t._uU(10),t.qZA()(),t.TgZ(11,"div")(12,"button",29),t.NdJ("click",function(){const r=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.makeAdmin(r))}),t.O4$(),t._UZ(13,"svg",30),t.qZA()()()}if(2&o){const e=d.$implicit,n=t.oxw();t.Gre("discussion ",n.selectedContact===(null==e?null:e._id)?"message-active":"",""),t.xp6(3),t.Oqu(n.getAvatar(null==e?null:e.name)),t.xp6(3),t.hij("",null==e?null:e.name," "),t.xp6(2),t.hij("( ",null==e?null:e.ITS," )"),t.xp6(2),t.Oqu(null==e?null:e.number),t.xp6(1),t.Gre("",null!=e&&e.isAdmin?"":"button-container"," d-flex"),t.xp6(1),t.Q6J("variant",null!=e&&e.isAdmin?"ghost":"outline")("color",null!=e&&e.isAdmin?"success":"secondary")}}function k(o,d){if(1&o&&(t.TgZ(0,"c-alert",31),t.O4$(),t._UZ(1,"svg",32),t.kcU(),t.TgZ(2,"div"),t._uU(3),t.qZA()()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("cIcon",e.icons.cilWarning),t.xp6(2),t.Oqu(e.errorMessage)}}const S=(o,d,e)=>({itemsPerPage:o,currentPage:d,totalItems:e});let I=(()=>{class o{constructor(e,n){this.chatService=e,this.fb=n,this.contactChange=new t.vpe,this.instanceSelected=new t.vpe,this.contactsList=[],this.visible=!1,this.searchControl=new a.NI(""),this.selectedInstance=new a.NI(""),this.refreshData$=new f.X(null),this.itemSize=10,this.totalItems=10,this.errorMessage="",this.icons={cilCheck:x.J,cilWarning:O},this.pageParams={page:1,limit:10}}ngOnInit(){this.form=this.fb.group({name:["",a.kI.required],ITS:["",a.kI.required],number:["",a.kI.required]}),this.getAllContacts(),this.searchControl.valueChanges.pipe((0,v.b)(1e3)).subscribe(e=>{this.getAllContacts(e)}),this.selectedInstance.valueChanges.pipe((0,v.b)(1e3)).subscribe(e=>{this.selectContact(e),this.instanceSelected.emit(e)})}toggleLiveDemo(){this.form.reset(),this.visible=!this.visible}handleLiveDemoChange(e){this.visible=e}submitForm(){this.form.invalid||this.chatService.addContact(this.form.value).subscribe(e=>{this.form.reset(),this.errorMessage="",this.handleLiveDemoChange(!1),this.getAllContacts()},e=>{this.errorMessage=e.error.error})}getAllContacts(e=""){this.refreshData$.pipe((0,M.w)(()=>this.chatService.getContacts({searchtext:e,...this.pageParams}))).subscribe(n=>{this.contactsList=n.data,this.totalItems=n.total})}getAvatar(e){return e?e[0].toUpperCase():""}selectContact(e){this.selectedContact=e?._id,this.contactChange.emit(e)}pageChange(e){this.pageParams.page=e,this.refreshData$.next(null)}makeAdmin(e){e.isAdmin?this.chatService.updateContact(e?._id,{...e,isAdmin:!1}).subscribe(n=>{p().fire({title:"Updated!",text:"Admin removed.",icon:"success",timer:1500}),this.refreshData$.next(null)}):p().fire({title:"Are you sure to approve admin access ?",icon:"question",showCancelButton:!0,confirmButtonText:"Confirm",cancelButtonText:"Cancel"}).then(n=>{n.isConfirmed&&this.chatService.updateContact(e?._id,{...e,isAdmin:!0}).subscribe(i=>{p().fire({title:"Updated!",text:"Admin approved.",icon:"success",timer:1500}),this.refreshData$.next(null)})})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(A),t.Y36(a.qu))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-contacts"]],inputs:{instancesList:"instancesList"},outputs:{contactChange:"contactChange",instanceSelected:"instanceSelected"},decls:35,vars:12,consts:[[1,"discussions"],[1,"discussion","search"],[1,"searchbar"],["aria-hidden","true",1,"fa","fa-search"],["type","text","placeholder","Search by Name, ITS or number",3,"formControl"],["cButton","","color","primary","variant","ghost",1,"ms-1",3,"click"],[3,"class","click",4,"ngFor","ngForOf"],[3,"pageChange"],["id","liveDemoModal",3,"visible","visibleChange"],["cModalTitle",""],["cButtonClose","",3,"click"],["color","danger","class","d-flex align-items-center",4,"ngIf"],["cForm","",3,"formGroup"],[1,"mb-3"],["cLabel","","for","Name"],["cFormControl","","id","Name","placeholder","John Doe","type","text","formControlName","name"],["cLabel","","for","ITS"],["cFormControl","","id","ITS","placeholder","30XXXXXX","type","text","formControlName","ITS"],["cLabel","","for","number"],["cFormControl","","id","number","placeholder","91805XXXXXXX","type","text","formControlName","number"],["cButton","","color","secondary",3,"click"],["cButton","","color","primary",3,"click"],[3,"click"],["id","avatar",1,"photo"],[1,"avatarText"],[1,"desc-contact"],[1,"name"],[1,"ITS"],[1,"message"],["cTooltip","Make Admin","cButton","","size","sm",1,"me-1",3,"variant","color","click"],["cIcon","","name","cil-star"],["color","danger",1,"d-flex","align-items-center"],["width","25","title","Shield Icon",3,"cIcon"]],template:function(n,i){1&n&&(t.TgZ(0,"section",0)(1,"div",1)(2,"div",2),t._UZ(3,"i",3)(4,"input",4),t.qZA(),t.TgZ(5,"button",5),t.NdJ("click",function(){return i.toggleLiveDemo()}),t._uU(6,"Add"),t.qZA()(),t.YNc(7,Z,14,12,"div",6),t.ALo(8,"paginate"),t.TgZ(9,"pagination-controls",7),t.NdJ("pageChange",function(l){return i.pageChange(l)}),t.qZA()(),t.TgZ(10,"c-modal",8),t.NdJ("visibleChange",function(l){return i.handleLiveDemoChange(l)}),t.TgZ(11,"c-modal-header")(12,"h5",9),t._uU(13,"Add new contact"),t.qZA(),t.TgZ(14,"button",10),t.NdJ("click",function(){return i.toggleLiveDemo()}),t.qZA()(),t.TgZ(15,"c-modal-body"),t.YNc(16,k,4,2,"c-alert",11),t.TgZ(17,"form",12)(18,"div",13)(19,"label",14),t._uU(20,"Name"),t.qZA(),t._UZ(21,"input",15),t.qZA(),t.TgZ(22,"div",13)(23,"label",16),t._uU(24,"ITS Number"),t.qZA(),t._UZ(25,"input",17),t.qZA(),t.TgZ(26,"div",13)(27,"label",18),t._uU(28,"Whatsapp Number"),t.qZA(),t._UZ(29,"input",19),t.qZA()()(),t.TgZ(30,"c-modal-footer")(31,"button",20),t.NdJ("click",function(){return i.toggleLiveDemo()}),t._uU(32," Close "),t.qZA(),t.TgZ(33,"button",21),t.NdJ("click",function(){return i.submitForm()}),t._uU(34,"Save changes"),t.qZA()()()),2&n&&(t.xp6(4),t.Q6J("formControl",i.searchControl),t.xp6(3),t.Q6J("ngForOf",t.xi3(8,5,i.contactsList,t.kEZ(8,S,i.itemSize,i.pageParams.page,i.totalItems))),t.xp6(3),t.Q6J("visible",i.visible),t.xp6(6),t.Q6J("ngIf",i.errorMessage),t.xp6(1),t.Q6J("formGroup",i.form))},dependencies:[h.sg,h.O5,b.ar,s.Hq3,s.PFQ,s.i9q,u.LS,s.$_X,s.oHf,s.eFW,a._Y,a.Fj,a.JJ,a.JL,a.oH,a.sg,a.u,s.KF4,s.zS7,s.YI7,s.Rbl,s.vPP,s.wxo,u._s],styles:[".discussions[_ngcontent-%COMP%]{height:550px;width:100%;box-shadow:0 8px 10px #0003;overflow:auto;background-color:#87a3ec;display:inline-block;position:relative}.discussions[_ngcontent-%COMP%]   .discussion[_ngcontent-%COMP%]{width:100%;height:60px;background-color:#fafafa;border-bottom:solid 1px #E0E0E0;display:flex;align-items:center;cursor:pointer}.discussions[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.discussions[_ngcontent-%COMP%]{-ms-overflow-style:none;scrollbar-width:none}.discussions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;color:#e0e0e0;position:sticky;top:0;z-index:1}.discussions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .searchbar[_ngcontent-%COMP%]{height:40px;background-color:#fff;width:70%;padding:0 20px;border-radius:50px;border:1px solid #EEEEEE;display:flex;align-items:center;cursor:pointer}.discussions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .searchbar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{margin-left:15px;height:38px;width:100%;border:none;outline:none;font-family:Montserrat,sans-serif}.discussions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .searchbar[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]::-webkit-input-placeholder{color:#929292}.discussions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .searchbar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:-moz-placeholder{color:#929292}.discussions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .searchbar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]::-moz-placeholder{color:#929292}.discussions[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]   .searchbar[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]:-ms-input-placeholder{color:#929292}.discussions[_ngcontent-%COMP%]   .message-active[_ngcontent-%COMP%]{height:65px;background-color:#fff;border-bottom:solid 1px #E0E0E0;border-left:5px solid #87a3ec}.discussions[_ngcontent-%COMP%]   .discussion[_ngcontent-%COMP%]   .photo[_ngcontent-%COMP%]{margin-left:20px;display:block;width:45px;height:45px;background:#E6E7ED;-moz-border-radius:50px;-webkit-border-radius:50px;background-position:center;background-size:cover;background-repeat:no-repeat;display:flex;justify-content:center;align-items:center;font-size:30px}.online[_ngcontent-%COMP%]{position:relative;top:15px;left:5px;width:13px;height:13px;background-color:#8bc34a;border-radius:13px;border:3px solid #FAFAFA}.avatarText[_ngcontent-%COMP%]{font-size:1.5rem;margin-left:10px;margin-top:5px}.desc-contact[_ngcontent-%COMP%]{height:43px;width:80%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.discussions[_ngcontent-%COMP%]   .discussion[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]{margin:0 0 0 20px;font-family:Montserrat,sans-serif;font-size:16px;color:#222}.discussions[_ngcontent-%COMP%]   .discussion[_ngcontent-%COMP%]   .name[_ngcontent-%COMP%]   .ITS[_ngcontent-%COMP%]{font-size:14px;color:#515151}.discussions[_ngcontent-%COMP%]   .discussion[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{margin:6px 0 0 20px;font-family:Montserrat,sans-serif;font-size:14px;color:#515151}.timer[_ngcontent-%COMP%]{margin-left:15%;font-family:Open Sans,sans-serif;font-size:11px;padding:3px 8px;color:#bbb;background-color:#fff;border:1px solid #E5E5E5;border-radius:15px}.button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:none}.discussion[_ngcontent-%COMP%]:hover   .button-container[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{display:inline-block}"]})}return o})();const U=[{path:"",component:(()=>{class o{constructor(e){this.apiService=e,this.instancesList=[]}ngOnInit(){this.fetchAllData()}contactChange(e){this.selectedContact=e}instanceSelected(e){this.selectedInstance=e}fetchAllData(){this.apiService.getListing().subscribe(e=>{this.instancesList=[...e.data]})}static#t=this.\u0275fac=function(n){return new(n||o)(t.Y36(_.s))};static#e=this.\u0275cmp=t.Xpm({type:o,selectors:[["app-container"]],decls:7,vars:1,consts:[[1,"fade-in"],[1,"h-75"],["sm","12","md","12"],[3,"instancesList","instanceSelected","contactChange"]],template:function(n,i){1&n&&(t.TgZ(0,"div",0)(1,"c-card")(2,"c-card-body")(3,"c-container")(4,"c-row",1)(5,"c-col",2)(6,"app-contacts",3),t.NdJ("instanceSelected",function(l){return i.instanceSelected(l)})("contactChange",function(l){return i.contactChange(l)}),t.qZA()()()()()()()),2&n&&(t.xp6(6),t.Q6J("instancesList",i.instancesList))},dependencies:[s.AkF,s.yue,s.Yp0,s.e$z,s.iok,I],styles:[".h-75[_ngcontent-%COMP%]{height:75vh!important}"]})}return o})()}];let w=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[C.Bz.forChild(U),C.Bz]})}return o})();var L=c(5722);let J=(()=>{class o{static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275mod=t.oAB({type:o});static#n=this.\u0275inj=t.cJS({imports:[h.ez,w,s.dTQ,s.zE6,s.TXv,s.U$I,b.QX,s.hJ1,s.gzQ,s.z8t,u.JX,s.ejP,g.JF,a.UX,s.zkK,s.nMh,L.ii.forRoot()]})}return o})()}}]);